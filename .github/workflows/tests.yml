name: tests


on: workflow_dispatch



jobs:
  test:
    runs-on:
      # group: nixgroup
      labels: nixos
    name: NixOS Testes
    steps:
      - name: checkout PR merge commit
        uses: actions/checkout@v4
        with:
          # Nix Flakes doesn't work on shallow clones
          fetch-depth: 0

      - name: Recolhe info
        run: |
          id
          pwd
          ls -la /nix/store | grep hello
          echo "${PATH//:/$'\n'}"

      - name: Testa sudo
        run: |
          stat -c '%a %n' $(which sudo)
          stat -c '%a %n' $(readlink -f $(which sudo))
          stat -c '%a %n' /run/wrappers/bin/sudo
          stat -c '%a %n' /run/current-system/sw/bin/sudo
          sudo id
          /run/wrappers/bin/sudo id
          /run/current-system/sw/bin/sudo id

      - name: Testa ping
        run: |
          python --version
          stat -c '%a %n' $(which ping)
          stat -c '%a %n' $(readlink -f $(which ping))
          stat -c '%a %n' $(readlink -f $(which newuidmap))
          stat -c '%a %n' $(readlink -f $(which newgidmap))
          stat -c '%a %n' /run/wrappers/bin/sudo
          /run/current-system/sw/bin/ping -c5 8.8.8.8
          ping -c5 8.8.8.8

      - name: Recolhe info show-config
        run: |
          nix show-config

      - name: profile install hello test
        run: |
          nix profile install nixpkgs#hello
          echo "${PATH//:/$'\n'}"
          nix profile list
          hello

      - name: profile install node test
        run: |
          nix profile install nixpkgs#nodejs
          echo "${PATH//:/$'\n'}"
          nix profile list
          node --version
