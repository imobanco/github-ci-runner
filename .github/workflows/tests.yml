name: tests


on: workflow_dispatch



jobs:
  test:
    runs-on:
      # group: nixgroup
      labels: nixos
    name: NixOS Testes
    steps:
      - name: checkout PR merge commit
        uses: actions/checkout@v4
        with:
          # Nix Flakes doesn't work on shallow clones
          fetch-depth: 0

      - name: Recolhe info
        run: |
          id
          pwd
          ls -la /nix/store | grep hello
          echo "${PATH//:/$'\n'}"

      - name: Testa ping
        run: |
          stat -c %a $(which ping)
          stat -c %a $(readlink -f $(which ping))
          /run/current-system/sw/bin/ping -c5 8.8.8.8
          ping -c5 8.8.8.8

      - name: Recolhe info show-config
        run: |
          nix show-config

      - name: profile install hello test
        run: |
          nix profile install nixpkgs#hello
          echo "${PATH//:/$'\n'}"
          nix profile list
          hello

      - name: profile install node test
        run: |
          nix profile install nixpkgs#nodejs
          echo "${PATH//:/$'\n'}"
          nix profile list
          node --version
