name: tests

on: workflow_dispatch
# on:
#   push:
#     branches:
#       - main
#   pull_request:
#     branchs:
#       - 'feature/**'
#       - 'fix/**'
#       - 'refactor/**'


jobs:
  test:
    runs-on: arc-runner-set
    name: Testes
    steps:
      - name: checkout PR merge commit
        uses: actions/checkout@v3

      - name: Rodar um echo
        run: echo 'teste'

      - name: Executa docker do host
        run: |
          # sudo apt-get install -y podman
          # docker pull alpine
          # docker images
          # docker info

      - name: Run alpine OCI image with docker and metadatas
        run: |
          # docker run alpine cat /etc/os*release
          cat /etc/os*release
          uname -a
          # nix flake metadata nixpkgs

      - name: Instala nix single user
        run: |
          BASE_URL='https://raw.githubusercontent.com/ES-Nix/get-nix/' \
          && SHA256=87fa0f1dbfdd28a1f99b39d5bd4dcc39de97bc64 \
          && NIX_RELEASE_VERSION='2.10.2' \
          && curl -fsSL "${BASE_URL}""$SHA256"/get-nix.sh | sh -s -- ${NIX_RELEASE_VERSION} \
          && . "$HOME"/.nix-profile/etc/profile.d/nix.sh \
          && . ~/."$(basename $SHELL)"rc \
          && export TMPDIR=/tmp \
          && nix flake --version \
          && nix registry pin nixpkgs github:NixOS/nixpkgs/ea4c80b39be4c09702b0cb3b42eab59e2ba4f24b \
          && curl -fsSL https://raw.githubusercontent.com/ES-Nix/get-nix/"$SHA256"/install_direnv_and_nix_direnv.sh | sh \
          && . ~/."$(basename $SHELL)"rc \
          && direnv --version
          echo "$HOME"/.nix-profile/bin >> $GITHUB_PATH

      - name: Testa nix
        run: |
          cat /etc/os*release
          uname -a
          nix flake metadata nixpkgs